{
  "id": "WgT72Z",
  "name": "interactive-tui-for-rafa",
  "description": "Add an interactive Terminal User Interface to Rafa that allows users to create plans from design documents and monitor execution progress without leaving the terminal.",
  "sourceFile": "docs/designs/tui-interactive.md",
  "createdAt": "2026-01-28T17:23:36.144337-06:00",
  "status": "in_progress",
  "tasks": [
    {
      "id": "t01",
      "title": "Set up TUI package structure and dependencies",
      "description": "Create the internal/tui/ package structure and add required Bubble Tea dependencies.\n\n## Package Structure to Create\n\n```\ninternal/tui/\nâ”œâ”€â”€ app.go           # Main Bubble Tea model, orchestrates views\nâ”œâ”€â”€ styles.go        # Lip Gloss styling (placeholder for t02)\nâ”œâ”€â”€ views/\nâ”‚   â”œâ”€â”€ home.go      # Landing screen (placeholder for t03)\nâ”‚   â”œâ”€â”€ filepicker.go# Browse/select design files (placeholder for t04)\nâ”‚   â”œâ”€â”€ create.go    # Plan creation progress (placeholder for t05)\nâ”‚   â”œâ”€â”€ planlist.go  # List existing plans (placeholder for t06)\nâ”‚   â””â”€â”€ run.go       # Execution monitor (placeholder for t08)\nâ””â”€â”€ components/\n    â”œâ”€â”€ statusbar.go # Bottom status/help bar (placeholder for t02)\n    â”œâ”€â”€ progress.go  # Task progress indicator (placeholder for t02)\n    â””â”€â”€ output.go    # Scrollable output viewport (placeholder for t02)\n```\n\n## app.go Implementation\n\n```go\npackage tui\n\nimport (\n    tea \"github.com/charmbracelet/bubbletea\"\n)\n\ntype View int\n\nconst (\n    ViewHome View = iota\n    ViewFilePicker\n    ViewCreating\n    ViewPlanList\n    ViewRunning\n)\n\ntype Model struct {\n    currentView  View\n    width        int\n    height       int\n\n    // Sub-models for each view (to be implemented in later tasks)\n    // home         homeModel\n    // filePicker   filePickerModel\n    // creating     creatingModel\n    // planList     planListModel\n    // running      runningModel\n\n    // Shared state\n    repoRoot     string\n    rafaDir      string\n    err          error\n}\n\nfunc Run() error {\n    p := tea.NewProgram(\n        initialModel(),\n        tea.WithAltScreen(),\n        tea.WithMouseCellMotion(),\n    )\n    _, err := p.Run()\n    return err\n}\n\nfunc initialModel() Model {\n    // Initialize with ViewHome, detect repoRoot and rafaDir\n}\n\nfunc (m Model) Init() tea.Cmd {\n    return nil\n}\n\nfunc (m Model) Update(msg tea.Msg) (tea.Model, tea.Cmd) {\n    switch msg := msg.(type) {\n    case tea.KeyMsg:\n        if msg.String() == \"q\" {\n            return m, tea.Quit\n        }\n    case tea.WindowSizeMsg:\n        m.width = msg.Width\n        m.height = msg.Height\n    }\n    return m, nil\n}\n\nfunc (m Model) View() string {\n    return \"Rafa TUI - Press q to quit\"\n}\n```\n\n## Entry Point Changes (cmd/rafa/main.go)\n\nModify the main function to detect whether to launch TUI or CLI:\n\n```go\nfunc main() {\n    // If no args, launch TUI\n    // If subcommand provided, route to existing CLI\n    if len(os.Args) == 1 {\n        if err := tui.Run(); err != nil {\n            fmt.Fprintf(os.Stderr, \"Error: %v\\n\", err)\n            os.Exit(1)\n        }\n    } else {\n        cli.Execute()\n    }\n}\n```",
      "acceptanceCriteria": [
        "go.mod includes github.com/charmbracelet/bubbletea, github.com/charmbracelet/bubbles, and github.com/charmbracelet/lipgloss",
        "internal/tui/app.go exists with Model struct containing currentView, width, height fields",
        "internal/tui/app.go has Run() function that creates tea.NewProgram with WithAltScreen and WithMouseCellMotion options",
        "Directory structure exists: internal/tui/views/ and internal/tui/components/ (can have placeholder files)",
        "cmd/rafa/main.go routes to tui.Run() when no arguments provided",
        "Running 'go build ./cmd/rafa' succeeds",
        "Running 'rafa' with no arguments launches TUI (shows placeholder, exits cleanly with q key)",
        "Running 'rafa plan list' still works and routes to CLI"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t02",
      "title": "Implement styles and reusable components",
      "description": "Create the shared styling system and three reusable components that will be used across all TUI views.\n\n## styles.go - Lip Gloss Styling\n\nCreate internal/tui/styles.go with consistent theme:\n\n```go\npackage tui\n\nimport \"github.com/charmbracelet/lipgloss\"\n\nvar (\n    // Colors\n    primaryColor   = lipgloss.Color(\"#7D56F4\")  // Purple accent\n    secondaryColor = lipgloss.Color(\"#6C6C6C\")  // Gray for secondary text\n    successColor   = lipgloss.Color(\"#73F59F\")  // Green for success\n    errorColor     = lipgloss.Color(\"#FF6B6B\")  // Red for errors\n    \n    // Title style for headers\n    TitleStyle = lipgloss.NewStyle().\n        Bold(true).\n        Foreground(primaryColor).\n        MarginBottom(1)\n    \n    // Subtle text for hints/help\n    SubtleStyle = lipgloss.NewStyle().\n        Foreground(secondaryColor)\n    \n    // Selected item in lists\n    SelectedStyle = lipgloss.NewStyle().\n        Bold(true).\n        Foreground(primaryColor)\n    \n    // Status bar at bottom\n    StatusBarStyle = lipgloss.NewStyle().\n        Background(lipgloss.Color(\"#333333\")).\n        Foreground(lipgloss.Color(\"#FFFFFF\")).\n        Padding(0, 1)\n    \n    // Box/panel borders\n    BoxStyle = lipgloss.NewStyle().\n        Border(lipgloss.RoundedBorder()).\n        BorderForeground(secondaryColor).\n        Padding(1, 2)\n)\n```\n\n## components/statusbar.go\n\nBottom bar showing contextual help items:\n\n```go\npackage components\n\n// StatusBar renders a bottom help bar\n// Usage: statusBar.Render(width, []string{\"â†‘â†“ Navigate\", \"Enter Select\", \"q Quit\"})\ntype StatusBar struct{}\n\nfunc NewStatusBar() StatusBar { ... }\n\n// Render returns the status bar string for given width and items\n// Items are joined with \" â€¢ \" separator, centered or left-aligned\nfunc (s StatusBar) Render(width int, items []string) string { ... }\n```\n\n## components/progress.go\n\nProgress bar component:\n\n```go\npackage components\n\n// Progress renders a progress bar like: â– â– â– â– â–¡â–¡â–¡â–¡ 50%\ntype Progress struct {\n    Current int\n    Total   int\n    Width   int  // character width of the bar portion\n}\n\nfunc NewProgress(current, total, width int) Progress { ... }\n\n// View returns the rendered progress bar string\nfunc (p Progress) View() string { ... }\n```\n\nRendering: Use â–  for filled, â–¡ for empty. Show percentage after bar.\n\n## components/output.go\n\nScrollable output viewport with auto-scroll:\n\n```go\npackage components\n\nimport \"github.com/charmbracelet/bubbles/viewport\"\n\n// OutputViewport wraps bubbles/viewport with auto-scroll behavior\ntype OutputViewport struct {\n    viewport   viewport.Model\n    autoScroll bool      // true = scroll to bottom on new content\n    lines      []string  // buffered lines\n    maxLines   int       // ring buffer size (default 1000)\n}\n\nfunc NewOutputViewport(width, height, maxLines int) OutputViewport { ... }\n\n// AddLine appends a line, drops oldest if buffer full\nfunc (o *OutputViewport) AddLine(line string) { ... }\n\n// Update handles viewport key events (scroll pauses auto-scroll)\nfunc (o *OutputViewport) Update(msg tea.Msg) (OutputViewport, tea.Cmd) { ... }\n\n// View returns the rendered viewport\nfunc (o OutputViewport) View() string { ... }\n```",
      "acceptanceCriteria": [
        "internal/tui/styles.go exists with Lip Gloss style definitions (TitleStyle, SubtleStyle, SelectedStyle, StatusBarStyle, BoxStyle)",
        "internal/tui/components/statusbar.go implements StatusBar with Render(width, items) method",
        "internal/tui/components/progress.go implements Progress with View() method rendering â– â–¡ bar with percentage",
        "internal/tui/components/output.go implements OutputViewport with AddLine(), Update(), View() methods",
        "OutputViewport uses ring buffer (maxLines) to prevent unbounded memory growth",
        "OutputViewport pauses autoScroll when user scrolls up manually",
        "Unit tests exist for Progress: 0% shows all empty, 50% shows half filled, 100% shows all filled",
        "Unit tests exist for StatusBar: renders items with separator, handles various widths",
        "make test passes"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t03",
      "title": "Implement Home view",
      "description": "Create the landing screen that users see when launching the TUI.\n\n## Visual Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                                 â”‚\nâ”‚                           R A F A                               â”‚\nâ”‚                    Task Loop Runner for AI                      â”‚\nâ”‚                                                                 â”‚\nâ”‚                                                                 â”‚\nâ”‚                    [c] Create new plan                          â”‚\nâ”‚                    [r] Run existing plan                        â”‚\nâ”‚                    [q] Quit                                     â”‚\nâ”‚                                                                 â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  â†‘â†“ Navigate  â€¢  Enter Select  â€¢  q Quit                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\nWhen .rafa/ directory doesn't exist:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                                 â”‚\nâ”‚                           R A F A                               â”‚\nâ”‚                    Task Loop Runner for AI                      â”‚\nâ”‚                                                                 â”‚\nâ”‚         No .rafa/ directory found.                              â”‚\nâ”‚         Run 'rafa init' first to initialize this repository.   â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  q Quit                                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation\n\nCreate internal/tui/views/home.go:\n\n```go\npackage views\n\nimport tea \"github.com/charmbracelet/bubbletea\"\n\n// Messages for view transitions (to be handled by app.go)\ntype GoToFilePickerMsg struct{}\ntype GoToPlanListMsg struct{}\n\ntype HomeModel struct {\n    menuItems    []string  // [\"Create new plan\", \"Run existing plan\", \"Quit\"]\n    cursor       int       // currently highlighted item\n    rafaExists   bool      // whether .rafa/ directory exists\n    width        int\n    height       int\n}\n\nfunc NewHomeModel(rafaDir string) HomeModel {\n    // Check if rafaDir exists\n}\n\nfunc (m HomeModel) Init() tea.Cmd { return nil }\n\nfunc (m HomeModel) Update(msg tea.Msg) (HomeModel, tea.Cmd) {\n    // Handle:\n    // - 'c' key -\u003e GoToFilePickerMsg\n    // - 'r' key -\u003e GoToPlanListMsg  \n    // - 'q' key -\u003e tea.Quit\n    // - Up/Down arrows -\u003e move cursor\n    // - Enter -\u003e select based on cursor position\n}\n\nfunc (m HomeModel) View() string {\n    // Render the layout shown above\n    // Use styles from ../styles.go\n    // Use StatusBar component at bottom\n}\n```",
      "acceptanceCriteria": [
        "internal/tui/views/home.go implements HomeModel with Init, Update, View methods",
        "Home view displays 'R A F A' title centered with 'Task Loop Runner for AI' tagline",
        "Home view shows three menu options with [c], [r], [q] shortcuts",
        "Menu items are navigable with arrow keys, currently selected item is highlighted",
        "When .rafa/ directory doesn't exist, view shows initialization message instead of menu",
        "Pressing 'c' or Enter on 'Create' returns GoToFilePickerMsg",
        "Pressing 'r' or Enter on 'Run' returns GoToPlanListMsg",
        "Pressing 'q' or Enter on 'Quit' returns tea.Quit",
        "StatusBar at bottom shows 'â†‘â†“ Navigate â€¢ Enter Select â€¢ q Quit'",
        "View adapts to terminal width/height from tea.WindowSizeMsg",
        "Unit tests verify: menu navigation, key shortcuts, .rafa/ existence check affects display",
        "make test passes"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t04",
      "title": "Implement FilePicker view",
      "description": "Create the file browser view for selecting design documents.\n\n## Visual Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Select Design Document                                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  ğŸ“ ..                                                          â”‚\nâ”‚  ğŸ“ docs/                                                       â”‚\nâ”‚  ğŸ“ src/                                                        â”‚\nâ”‚  ğŸ“„ README.md                                                   â”‚\nâ”‚  ğŸ“„ design.md                              â† highlighted        â”‚\nâ”‚  ğŸ“„ prd.md                                                      â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  â†‘â†“ Navigate  â€¢  Enter Select  â€¢  Esc Back                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation\n\nCreate internal/tui/views/filepicker.go:\n\n```go\npackage views\n\nimport (\n    \"github.com/charmbracelet/bubbles/filepicker\"\n    tea \"github.com/charmbracelet/bubbletea\"\n)\n\n// Message when file is selected\ntype FileSelectedMsg struct {\n    Path string  // absolute path to selected file\n}\n\n// Message to go back to home\ntype GoToHomeMsg struct{}\n\ntype FilePickerModel struct {\n    picker   filepicker.Model\n    repoRoot string\n    width    int\n    height   int\n}\n\nfunc NewFilePickerModel(repoRoot string) FilePickerModel {\n    fp := filepicker.New()\n    fp.CurrentDirectory = repoRoot\n    fp.AllowedTypes = []string{\".md\"}  // Filter to markdown files\n    fp.ShowHidden = false\n    // Configure other filepicker options\n    return FilePickerModel{picker: fp, repoRoot: repoRoot}\n}\n\nfunc (m FilePickerModel) Init() tea.Cmd {\n    return m.picker.Init()\n}\n\nfunc (m FilePickerModel) Update(msg tea.Msg) (FilePickerModel, tea.Cmd) {\n    // Handle Escape -\u003e GoToHomeMsg\n    // Delegate to filepicker, check for file selection\n    // On selection -\u003e FileSelectedMsg{Path: selectedPath}\n}\n\nfunc (m FilePickerModel) View() string {\n    // Render title \"Select Design Document\"\n    // Render filepicker\n    // Render StatusBar with navigation hints\n}\n```\n\n## Notes\n- The bubbles/filepicker handles directory navigation, file listing, and selection\n- Use ğŸ“ for directories and ğŸ“„ for files (filepicker may have its own icons)\n- Constrain navigation to start from repo root for security",
      "acceptanceCriteria": [
        "internal/tui/views/filepicker.go implements FilePickerModel using bubbles/filepicker",
        "File picker starts in repository root directory",
        "File picker shows only .md files and directories (AllowedTypes filter)",
        "Directories show with folder indicator, files show with file indicator",
        "Arrow keys navigate file list, Enter opens directories or selects files",
        "Selecting a .md file returns FileSelectedMsg with the absolute file path",
        "Pressing Escape returns GoToHomeMsg to transition back to Home",
        "Title 'Select Design Document' appears at top of view",
        "StatusBar shows: 'â†‘â†“ Navigate â€¢ Enter Select â€¢ Esc Back'",
        "View adapts to terminal width/height",
        "Unit tests verify: file selection returns correct path, Escape returns home message",
        "make test passes"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t05",
      "title": "Implement Creating view with AI integration",
      "description": "Create the plan creation progress view that shows a spinner while extracting tasks from a design document.\n\n## Visual Layout - During Extraction\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Creating Plan                                                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                 â”‚\nâ”‚  Source: docs/designs/feature-auth.md                           â”‚\nâ”‚                                                                 â”‚\nâ”‚  â£¾ Extracting tasks from design...                              â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Please wait...  â€¢  Ctrl+C Cancel                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Visual Layout - On Success\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Plan Created                                                   â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                 â”‚\nâ”‚  âœ“ Plan created: xK9pQ2-feature-auth                            â”‚\nâ”‚                                                                 â”‚\nâ”‚  Tasks:                                                         â”‚\nâ”‚    1. Set up authentication middleware                          â”‚\nâ”‚    2. Implement user login endpoint                             â”‚\nâ”‚    3. Add session management                                    â”‚\nâ”‚    4. Write integration tests                                   â”‚\nâ”‚                                                                 â”‚\nâ”‚  [r] Run this plan now    [h] Return to home                    â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  r Run plan  â€¢  h Home  â€¢  q Quit                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Visual Layout - On Error\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Plan Creation Failed                                           â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                 â”‚\nâ”‚  âœ— Error: Failed to extract tasks                               â”‚\nâ”‚                                                                 â”‚\nâ”‚  Details: Network timeout connecting to Claude API              â”‚\nâ”‚                                                                 â”‚\nâ”‚  [r] Retry    [b] Back to file picker    [h] Home               â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  r Retry  â€¢  b Back  â€¢  h Home                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation\n\n```go\npackage views\n\nimport (\n    \"github.com/charmbracelet/bubbles/spinner\"\n    tea \"github.com/charmbracelet/bubbletea\"\n)\n\ntype createState int\nconst (\n    stateExtracting createState = iota\n    stateSuccess\n    stateError\n)\n\n// Message when extraction completes\ntype PlanCreatedMsg struct {\n    PlanID string\n    Tasks  []string  // task titles for display\n}\n\ntype PlanCreationErrorMsg struct {\n    Err error\n}\n\n// Message to run the created plan\ntype RunPlanMsg struct {\n    PlanID string\n}\n\ntype CreatingModel struct {\n    state      createState\n    spinner    spinner.Model\n    sourceFile string    // path to design doc\n    planID     string    // set after successful creation\n    tasks      []string  // task titles after creation\n    err        error     // set on failure\n    width      int\n    height     int\n}\n\nfunc NewCreatingModel(sourceFile string) CreatingModel {\n    s := spinner.New()\n    s.Spinner = spinner.Dot  // â£¾ style spinner\n    return CreatingModel{\n        state:      stateExtracting,\n        spinner:    s,\n        sourceFile: sourceFile,\n    }\n}\n\nfunc (m CreatingModel) Init() tea.Cmd {\n    return tea.Batch(\n        m.spinner.Tick,\n        m.startExtraction(),  // kicks off background goroutine\n    )\n}\n\nfunc (m CreatingModel) startExtraction() tea.Cmd {\n    return func() tea.Msg {\n        // Call ai.ExtractTasks() or equivalent\n        // On success: return PlanCreatedMsg{...}\n        // On error: return PlanCreationErrorMsg{...}\n    }\n}\n\n// Update handles state transitions and key presses\n// View renders based on current state\n```\n\n## Integration with existing code\n\nUse the existing internal/ai/ package to extract tasks. Look at how the CLI's 'rafa plan create' command does this.",
      "acceptanceCriteria": [
        "internal/tui/views/create.go implements CreatingModel with three states: extracting, success, error",
        "During extraction: shows source file path and animated spinner (â£¾ style)",
        "Spinner animates using bubbles/spinner with Tick commands",
        "Plan creation runs in background using tea.Cmd pattern (not blocking UI)",
        "On success: displays plan ID, task count, and numbered task titles",
        "Success state shows '[r] Run this plan now' and '[h] Return to home' options",
        "Pressing 'r' in success state returns RunPlanMsg with the created plan ID",
        "Pressing 'h' in success state returns GoToHomeMsg",
        "On error: displays error message with details",
        "Error state shows '[r] Retry', '[b] Back to file picker', '[h] Home' options",
        "Ctrl+C during extraction cancels and returns GoToFilePickerMsg",
        "StatusBar shows context-appropriate help for each state",
        "Unit tests verify: spinner state, success display, error display, key handling for each state",
        "make test passes"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t06",
      "title": "Implement PlanList view",
      "description": "Create the plan selection view for choosing an existing plan to run.\n\n## Visual Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Select Plan to Run                                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                 â”‚\nâ”‚  â— xK9pQ2-feature-auth       4 tasks   not_started              â”‚\nâ”‚  â—‹ mN3jL7-refactor-db        6 tasks   completed                â”‚\nâ”‚  â—‹ pR8wK1-add-tests          3 tasks   in_progress (2/3)        â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  â†‘â†“ Navigate  â€¢  Enter Run  â€¢  Esc Back                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Visual Layout - No Plans\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Select Plan to Run                                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                                 â”‚\nâ”‚  No plans found.                                                â”‚\nâ”‚                                                                 â”‚\nâ”‚  Press 'c' to create a new plan, or Esc to go back.             â”‚\nâ”‚                                                                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  c Create plan  â€¢  Esc Back                                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Implementation\n\n```go\npackage views\n\nimport tea \"github.com/charmbracelet/bubbletea\"\n\ntype PlanSummary struct {\n    ID          string\n    Name        string\n    TaskCount   int\n    Status      string  // \"not_started\", \"in_progress\", \"completed\"\n    Completed   int     // for in_progress: how many done\n}\n\ntype PlanListModel struct {\n    plans    []PlanSummary\n    cursor   int\n    rafaDir  string\n    width    int\n    height   int\n}\n\nfunc NewPlanListModel(rafaDir string) PlanListModel {\n    // Load plans from rafaDir/plans/\n    // Each plan directory has plan.json with status info\n}\n\nfunc (m PlanListModel) loadPlans() []PlanSummary {\n    // Read .rafa/plans/*/plan.json files\n    // Extract ID, name, task count, status\n    // For in_progress plans, count completed tasks\n}\n\n// Display format for each plan:\n// â— xK9pQ2-feature-auth       4 tasks   not_started\n// Use â— for selected, â—‹ for unselected\n// Align columns: ID+name, task count, status\n```\n\n## Integration with existing code\n\nUse internal/plan/ package to load plan data. Plans are stored in .rafa/plans/\u003cid\u003e-\u003cname\u003e/plan.json",
      "acceptanceCriteria": [
        "internal/tui/views/planlist.go implements PlanListModel",
        "View loads plans from .rafa/plans/ directory on initialization",
        "Each plan row shows: selection indicator (â—/â—‹), plan ID-name, task count, status",
        "In-progress plans show progress fraction like 'in_progress (2/3)'",
        "Completed plans are visually distinct (e.g., dimmed) but still selectable",
        "Arrow keys navigate plan list, â— shows on currently selected item",
        "Enter on selected plan returns RunPlanMsg with plan ID",
        "When no plans exist, shows 'No plans found.' with hint to create one",
        "In empty state, 'c' key returns GoToFilePickerMsg to create a plan",
        "Escape returns GoToHomeMsg",
        "StatusBar shows: 'â†‘â†“ Navigate â€¢ Enter Run â€¢ Esc Back'",
        "Unit tests verify: empty state display, plan loading, selection, status formatting",
        "make test passes"
      ],
      "status": "completed",
      "attempts": 1
    },
    {
      "id": "t07",
      "title": "Add ExecutorEvents interface and adapt Executor",
      "description": "Extend the executor package to support TUI integration via an events interface. This allows the TUI to receive real-time updates without modifying the core execution logic.\n\n## New Interface\n\nCreate internal/executor/events.go:\n\n```go\npackage executor\n\nimport (\n    \"time\"\n    \"github.com/yourusername/rafa/internal/plan\"\n)\n\n// ExecutorEvents receives callbacks during plan execution.\n// Implement this interface in the TUI to receive updates.\ntype ExecutorEvents interface {\n    // OnTaskStart is called when a task begins execution\n    OnTaskStart(taskNum, total int, task *plan.Task, attempt int)\n    \n    // OnTaskComplete is called when a task succeeds\n    OnTaskComplete(task *plan.Task)\n    \n    // OnTaskFailed is called when a task attempt fails\n    OnTaskFailed(task *plan.Task, attempt int, err error)\n    \n    // OnOutput is called for each line of output from the AI\n    OnOutput(line string)\n    \n    // OnPlanComplete is called when all tasks finish successfully\n    OnPlanComplete(succeeded, total int, duration time.Duration)\n    \n    // OnPlanFailed is called when a task exhausts retries\n    OnPlanFailed(task *plan.Task, reason string)\n}\n```\n\n## Executor Changes\n\nModify internal/executor/executor.go:\n\n```go\ntype Executor struct {\n    // ... existing fields ...\n    events ExecutorEvents  // nil for CLI mode\n}\n\n// WithEvents configures event callbacks for TUI integration\nfunc (e *Executor) WithEvents(events ExecutorEvents) *Executor {\n    e.events = events\n    return e\n}\n\n// In execution methods, emit events:\nfunc (e *Executor) executeTask(...) {\n    if e.events != nil {\n        e.events.OnTaskStart(taskNum, total, task, attempt)\n    }\n    // ... existing logic ...\n}\n```\n\n## Output Streaming Changes\n\nModify internal/executor/output.go (or wherever output is handled):\n\n```go\ntype StreamingOutput struct {\n    logFile    *os.File\n    eventsChan chan string  // For TUI consumption, nil for CLI\n}\n\nfunc (s *StreamingOutput) Write(p []byte) (n int, err error) {\n    // Write to log file (existing behavior)\n    n, err = s.logFile.Write(p)\n    \n    // Send to TUI if channel exists (non-blocking)\n    if s.eventsChan != nil {\n        select {\n        case s.eventsChan \u003c- string(p):\n        default:\n            // Drop if buffer full, don't block execution\n        }\n    }\n    return\n}\n```\n\n## Important: Preserve CLI Behavior\n\nWhen events is nil, the executor must work exactly as before, using display.Display for CLI output. The TUI integration is additive.",
      "acceptanceCriteria": [
        "internal/executor/events.go defines ExecutorEvents interface with 6 methods: OnTaskStart, OnTaskComplete, OnTaskFailed, OnOutput, OnPlanComplete, OnPlanFailed",
        "Executor struct has 'events' field of type ExecutorEvents",
        "Executor has WithEvents(ExecutorEvents) *Executor method",
        "Executor calls OnTaskStart before each task execution when events != nil",
        "Executor calls OnTaskComplete or OnTaskFailed after each task when events != nil",
        "Executor calls OnPlanComplete or OnPlanFailed at end of execution when events != nil",
        "StreamingOutput has eventsChan for real-time output streaming",
        "StreamingOutput.Write sends to eventsChan with non-blocking select (drops if full)",
        "When events is nil, executor uses existing display.Display behavior unchanged",
        "Existing CLI commands (rafa run) work correctly with no behavior changes",
        "Unit tests verify: events are emitted at correct times, nil events doesn't crash, output streaming works",
        "make test passes"
      ],
      "status": "pending",
      "attempts": 0
    },
    {
      "id": "t08",
      "title": "Implement Running view with split layout",
      "description": "Create the execution monitor view with a split-panel layout showing progress and output simultaneously.\n\n## Visual Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Running: xK9pQ2-feature-auth                                   â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Progress                         â”‚  Output                     â”‚\nâ”‚                                   â”‚                             â”‚\nâ”‚  Task 2/4: Implement login        â”‚  Analyzing codebase...      â”‚\nâ”‚  Attempt: 1/5                     â”‚  Found auth/ directory      â”‚\nâ”‚  Elapsed: 00:03:42                â”‚  Creating login handler...  â”‚\nâ”‚                                   â”‚  Writing tests...           â”‚\nâ”‚  â– â– â– â– â–¡â–¡â–¡â–¡ 50%                     â”‚  \u003e npm test                 â”‚\nâ”‚                                   â”‚  PASS src/auth/login.test   â”‚\nâ”‚  Tasks:                           â”‚  All tests passed           â”‚\nâ”‚  âœ“ 1. Set up middleware           â”‚                             â”‚\nâ”‚  â£¾ 2. Implement login      â†      â”‚  Committing changes...      â”‚\nâ”‚  â—‹ 3. Add session mgmt            â”‚                             â”‚\nâ”‚  â—‹ 4. Write integration tests     â”‚                             â”‚\nâ”‚                                   â”‚                             â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Running...  â€¢  Ctrl+C Cancel                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Layout Details\n\n- Left panel: 40% width - Progress information\n- Right panel: 60% width - Scrollable output\n- Panels separated by vertical border\n- Use Lip Gloss JoinHorizontal for split layout\n\n## Status Indicators for Task List\n\n- âœ“ completed (green)\n- â£¾ in progress (animated spinner)\n- â—‹ pending (dim)\n- âœ— failed (red)\n\n## Implementation\n\n```go\npackage views\n\nimport (\n    \"time\"\n    \"github.com/charmbracelet/bubbles/spinner\"\n    tea \"github.com/charmbracelet/bubbletea\"\n    \"github.com/yourusername/rafa/internal/executor\"\n    \"github.com/yourusername/rafa/internal/plan\"\n)\n\n// RunningModel implements executor.ExecutorEvents\ntype RunningModel struct {\n    planID       string\n    planName     string\n    tasks        []TaskDisplay  // task info for display\n    currentTask  int\n    totalTasks   int\n    attempt      int\n    maxAttempts  int\n    startTime    time.Time\n    \n    spinner      spinner.Model\n    output       components.OutputViewport\n    progress     components.Progress\n    \n    outputChan   chan string  // receives output from executor\n    done         bool\n    cancelled    bool\n    finalStatus  string  // \"completed\" or \"failed\"\n    \n    width        int\n    height       int\n}\n\ntype TaskDisplay struct {\n    Title  string\n    Status string  // \"pending\", \"running\", \"completed\", \"failed\"\n}\n\n// Implement ExecutorEvents interface\nfunc (m *RunningModel) OnTaskStart(taskNum, total int, task *plan.Task, attempt int) {\n    // Send tea.Msg to update state\n}\n\nfunc (m *RunningModel) OnOutput(line string) {\n    // Send to outputChan\n}\n\n// ... other ExecutorEvents methods ...\n\n// TUI message types for executor events\ntype TaskStartedMsg struct { ... }\ntype TaskCompletedMsg struct { ... }\ntype OutputLineMsg struct { Line string }\ntype PlanDoneMsg struct { Success bool; Message string }\n\nfunc (m RunningModel) Init() tea.Cmd {\n    return tea.Batch(\n        m.spinner.Tick,\n        m.startExecution(),     // launches executor in goroutine\n        m.listenForOutput(),    // reads from outputChan\n    )\n}\n```\n\n## Handling Ctrl+C\n\nOn Ctrl+C:\n1. Signal executor to stop gracefully (via context cancellation)\n2. Wait for current task to finish or timeout\n3. Show summary: \"Cancelled. Completed X/Y tasks.\"\n4. Return to Home view after showing summary\n\n## Auto-scroll Behavior\n\nThe output viewport should:\n- Auto-scroll to bottom when new content arrives\n- Pause auto-scroll if user scrolls up (using arrow keys or mouse)\n- Resume auto-scroll if user scrolls back to bottom",
      "acceptanceCriteria": [
        "internal/tui/views/run.go implements RunningModel with split layout",
        "Left panel (40%) shows: plan name, current task number/total, attempt counter, elapsed time (MM:SS), progress bar, task list",
        "Right panel (60%) shows scrollable OutputViewport with real-time output",
        "Panels are joined horizontally using Lip Gloss with visible separator",
        "Task list uses status indicators: âœ“ (completed), â£¾ (in progress spinner), â—‹ (pending), âœ— (failed)",
        "In-progress task has animated spinner that ticks with the view",
        "RunningModel implements executor.ExecutorEvents interface",
        "Events from executor are translated to Bubble Tea messages via channel",
        "Output viewport auto-scrolls to bottom on new content",
        "User can scroll output up (pauses auto-scroll), scrolling to bottom resumes auto-scroll",
        "Ctrl+C triggers graceful cancellation via context",
        "After cancellation or completion, view shows summary and transition message",
        "StatusBar shows 'Running... â€¢ Ctrl+C Cancel'",
        "Unit tests verify: split layout rendering, event handling, status indicators, cancellation",
        "make test passes"
      ],
      "status": "pending",
      "attempts": 0
    },
    {
      "id": "t09",
      "title": "Wire up view transitions and complete TUI flow",
      "description": "Complete the app.go orchestration to connect all views and handle transitions between them.\n\n## Prerequisites\n\nThis task requires all views to be implemented (t03-t06, t08). It connects them together.\n\n## Message Types for Transitions\n\nDefine in internal/tui/messages.go or app.go:\n\n```go\npackage tui\n\n// View transition messages\ntype GoToHomeMsg struct{}\ntype GoToFilePickerMsg struct{}\ntype GoToCreatingMsg struct{ SourceFile string }\ntype GoToPlanListMsg struct{}\ntype GoToRunningMsg struct{ PlanID string }\n\n// Special messages\ntype FileSelectedMsg struct{ Path string }  // from FilePicker\ntype PlanCreatedMsg struct{ PlanID string; Tasks []string }  // from Creating\ntype RunPlanMsg struct{ PlanID string }  // from Creating or PlanList\ntype ExecutionDoneMsg struct{ Success bool }  // from Running\n```\n\n## App Model Updates\n\n```go\ntype Model struct {\n    currentView  View\n    width        int\n    height       int\n\n    // Sub-models\n    home         views.HomeModel\n    filePicker   views.FilePickerModel\n    creating     views.CreatingModel\n    planList     views.PlanListModel\n    running      views.RunningModel\n\n    // Shared state\n    repoRoot     string\n    rafaDir      string\n}\n\nfunc (m Model) Update(msg tea.Msg) (tea.Model, tea.Cmd) {\n    switch msg := msg.(type) {\n    \n    case tea.WindowSizeMsg:\n        m.width = msg.Width\n        m.height = msg.Height\n        // Propagate to current view\n        \n    case GoToHomeMsg:\n        m.currentView = ViewHome\n        m.home = views.NewHomeModel(m.rafaDir)\n        return m, m.home.Init()\n        \n    case GoToFilePickerMsg:\n        m.currentView = ViewFilePicker\n        m.filePicker = views.NewFilePickerModel(m.repoRoot)\n        return m, m.filePicker.Init()\n        \n    case FileSelectedMsg:\n        m.currentView = ViewCreating\n        m.creating = views.NewCreatingModel(msg.Path)\n        return m, m.creating.Init()\n        \n    case GoToPlanListMsg:\n        m.currentView = ViewPlanList\n        m.planList = views.NewPlanListModel(m.rafaDir)\n        return m, m.planList.Init()\n        \n    case RunPlanMsg:\n        m.currentView = ViewRunning\n        m.running = views.NewRunningModel(msg.PlanID, m.rafaDir)\n        return m, m.running.Init()\n        \n    case ExecutionDoneMsg:\n        m.currentView = ViewHome\n        m.home = views.NewHomeModel(m.rafaDir)\n        return m, m.home.Init()\n    }\n    \n    // Delegate to current view\n    switch m.currentView {\n    case ViewHome:\n        var cmd tea.Cmd\n        m.home, cmd = m.home.Update(msg)\n        return m, cmd\n    // ... other views ...\n    }\n}\n\nfunc (m Model) View() string {\n    switch m.currentView {\n    case ViewHome:\n        return m.home.View()\n    case ViewFilePicker:\n        return m.filePicker.View()\n    // ... etc ...\n    }\n}\n```\n\n## Complete User Flows to Test\n\n1. **Create and Run Flow**:\n   - Launch TUI â†’ Home\n   - Press 'c' â†’ FilePicker\n   - Select file â†’ Creating (with spinner)\n   - Wait for completion â†’ Creating (success state)\n   - Press 'r' â†’ Running\n   - Wait for completion â†’ Home\n\n2. **Run Existing Flow**:\n   - Launch TUI â†’ Home\n   - Press 'r' â†’ PlanList\n   - Select plan â†’ Running\n   - Wait for completion â†’ Home\n\n3. **Navigation Flow**:\n   - From any view, Escape returns to parent\n   - From Home, 'q' quits",
      "acceptanceCriteria": [
        "internal/tui/app.go (or messages.go) defines all transition message types",
        "App Update() handles all transition messages and switches currentView",
        "App View() renders the correct view based on currentView",
        "Window resize (tea.WindowSizeMsg) propagates size to all sub-views",
        "Data flows between views: FilePickerâ†’Creating (file path), Creatingâ†’Running (plan ID), PlanListâ†’Running (plan ID)",
        "Complete create flow works: Home â†’ 'c' â†’ FilePicker â†’ select â†’ Creating â†’ success â†’ 'r' â†’ Running â†’ done â†’ Home",
        "Complete run flow works: Home â†’ 'r' â†’ PlanList â†’ select â†’ Running â†’ done â†’ Home",
        "Escape from FilePicker returns to Home",
        "Escape from PlanList returns to Home",
        "Escape from Creating (before completion) returns to FilePicker",
        "After Running completes, automatically transitions to Home",
        "All views receive correct width/height on resize",
        "make test passes"
      ],
      "status": "pending",
      "attempts": 0
    },
    {
      "id": "t10",
      "title": "Handle edge cases and error states",
      "description": "Implement robust handling for all edge cases to make the TUI production-ready.\n\n## Edge Cases to Handle\n\n### 1. Terminal Too Small\n\nMinimum usable size: 60 columns x 15 rows\n\n```go\nfunc (m Model) View() string {\n    if m.width \u003c 60 || m.height \u003c 15 {\n        return lipgloss.Place(\n            m.width, m.height,\n            lipgloss.Center, lipgloss.Center,\n            \"Terminal too small.\\nMinimum: 60x15\\nCurrent: \"+fmt.Sprintf(\"%dx%d\", m.width, m.height),\n        )\n    }\n    // normal view rendering\n}\n```\n\n### 2. Plan is Locked (Running Elsewhere)\n\nCheck for lock file in plan directory:\n\n```go\n// In PlanListModel, when loading plans:\nfunc isLocked(planDir string) bool {\n    lockFile := filepath.Join(planDir, \".lock\")\n    _, err := os.Stat(lockFile)\n    return err == nil\n}\n\n// Display locked plans differently, prevent selection:\n// ğŸ”’ xK9pQ2-feature-auth       4 tasks   running (locked)\n```\n\n### 3. Claude CLI Not Found\n\nCheck on first action that needs it (plan creation or execution):\n\n```go\ntype ClaudeCLINotFoundMsg struct{}\n\nfunc checkClaudeCLI() tea.Cmd {\n    return func() tea.Msg {\n        _, err := exec.LookPath(\"claude\")\n        if err != nil {\n            return ClaudeCLINotFoundMsg{}\n        }\n        return nil\n    }\n}\n\n// Display error:\n// âœ— Claude CLI not found\n// \n// Install Claude CLI and ensure it's in your PATH.\n// See: https://docs.anthropic.com/claude-cli\n```\n\n### 4. Output Buffer Overflow\n\nAlready handled in t02 (OutputViewport with ring buffer), but verify:\n- Default maxLines = 1000\n- When buffer is full, oldest lines are dropped\n- No memory growth beyond buffer size\n\n### 5. Network Timeout During Extraction\n\nHandle in Creating view:\n- Show specific error message for timeout\n- Offer retry option\n- Don't lose the selected file path on error\n\n### 6. Ctrl+C During Creation\n\nIn Creating view:\n- Cancel the extraction goroutine (via context)\n- Return to FilePicker with file path preserved\n- Show brief \"Cancelled\" message\n\n### 7. Ctrl+C During Execution\n\nIn Running view:\n- Signal executor to stop gracefully\n- Save current plan state (task statuses)\n- Show summary: \"Stopped. Completed X/Y tasks.\"\n- Wait for user acknowledgment before returning to Home",
      "acceptanceCriteria": [
        "When terminal is smaller than 60x15, show centered size warning instead of normal view",
        "Size warning shows both minimum and current dimensions",
        "Locked plans (with .lock file) show lock indicator and cannot be selected in PlanList",
        "Attempting to select locked plan shows 'Plan is running elsewhere' message",
        "Before plan creation, check for claude CLI; show descriptive error if not found",
        "Error message for missing Claude CLI includes installation hint",
        "OutputViewport ring buffer verified: adding 1001+ lines keeps only latest 1000",
        "Network timeout in Creating shows specific timeout error with Retry option",
        "Retry in Creating re-attempts extraction with same source file",
        "Ctrl+C in Creating cancels extraction and returns to FilePicker",
        "FilePicker state (current directory) is preserved when returning from cancelled creation",
        "Ctrl+C in Running triggers graceful stop, waits for current operation",
        "After Ctrl+C stop, Running shows 'Stopped. Completed X/Y tasks.' summary",
        "Plan state is saved after Ctrl+C stop (completed tasks remain completed)",
        "Unit tests exist for: terminal size check, locked plan detection, buffer overflow handling",
        "make test passes"
      ],
      "status": "pending",
      "attempts": 0
    },
    {
      "id": "t11",
      "title": "Add integration tests for TUI flows",
      "description": "Create comprehensive integration tests that verify complete user flows through the TUI.\n\n## Test Setup\n\nUse Bubble Tea's testing utilities:\n\n```go\npackage tui_test\n\nimport (\n    \"testing\"\n    tea \"github.com/charmbracelet/bubbletea\"\n    \"github.com/charmbracelet/x/exp/teatest\"\n)\n\n// Helper to create test model with mocked dependencies\nfunc setupTestModel(t *testing.T) (Model, string) {\n    // Create temp directory with .rafa/ structure\n    // Return model and cleanup path\n}\n\n// Mock AI for plan creation\ntype mockAI struct {\n    tasks []string\n    err   error\n}\n```\n\n## Test Cases\n\n### 1. Complete Create Flow\n\n```go\nfunc TestCreatePlanFlow(t *testing.T) {\n    // Setup: temp repo with .rafa/ and a design.md file\n    // Start at Home\n    // Send 'c' key â†’ verify FilePicker view\n    // Navigate to design.md, send Enter â†’ verify Creating view\n    // Wait for mock AI completion â†’ verify success state with tasks\n    // Send 'r' key â†’ verify Running view\n    // Wait for mock execution â†’ verify completion and return to Home\n}\n```\n\n### 2. Complete Run Flow\n\n```go\nfunc TestRunExistingPlanFlow(t *testing.T) {\n    // Setup: temp repo with existing plan in .rafa/plans/\n    // Start at Home\n    // Send 'r' key â†’ verify PlanList view with plan visible\n    // Send Enter on plan â†’ verify Running view\n    // Wait for completion â†’ verify return to Home\n}\n```\n\n### 3. Keyboard Navigation\n\n```go\nfunc TestKeyboardNavigation(t *testing.T) {\n    // Home: arrow keys move selection, Enter activates\n    // FilePicker: arrows navigate, Escape goes back\n    // PlanList: arrows navigate, Escape goes back\n    // All views: 'q' from Home quits\n}\n```\n\n### 4. Window Resize\n\n```go\nfunc TestWindowResize(t *testing.T) {\n    // Send WindowSizeMsg with various sizes\n    // Verify layout adapts\n    // Verify minimum size warning appears when too small\n}\n```\n\n### 5. Error States\n\n```go\nfunc TestErrorStates(t *testing.T) {\n    // No .rafa/ â†’ Home shows init message\n    // No plans â†’ PlanList shows empty state\n    // Extraction fails â†’ Creating shows error with retry\n    // Locked plan â†’ PlanList shows locked, prevents selection\n}\n```\n\n### 6. Cancellation\n\n```go\nfunc TestCancellation(t *testing.T) {\n    // Ctrl+C during Creating â†’ returns to FilePicker\n    // Ctrl+C during Running â†’ shows summary, then Home\n}\n```\n\n## Running Integration Tests\n\nIntegration tests may be slower; consider build tag:\n\n```go\n//go:build integration\n\npackage tui_test\n```\n\nRun with: `go test -tags=integration ./internal/tui/...`\n\nOr include in normal test run if fast enough.",
      "acceptanceCriteria": [
        "internal/tui/integration_test.go exists with integration tests",
        "Test helper creates temp directory with .rafa/ structure for isolation",
        "Mock AI implementation allows controlling extraction results",
        "TestCreatePlanFlow verifies: Home â†’ FilePicker â†’ Creating â†’ success â†’ Running â†’ Home",
        "TestRunExistingPlanFlow verifies: Home â†’ PlanList â†’ Running â†’ Home",
        "TestKeyboardNavigation verifies arrow navigation and Enter/Escape in all views",
        "TestWindowResize verifies layout adapts to size changes",
        "TestWindowResize verifies minimum size warning appears for small terminals",
        "TestErrorStates verifies: no .rafa/ message, empty plan list, extraction error display",
        "TestCancellation verifies Ctrl+C behavior in Creating and Running views",
        "Tests clean up temp directories after completion",
        "All integration tests pass with make test",
        "Tests don't require network (all external calls mocked)"
      ],
      "status": "pending",
      "attempts": 0
    },
    {
      "id": "t12",
      "title": "Polish TUI appearance and update documentation",
      "description": "Final polish pass to ensure visual consistency and update project documentation.\n\n## Visual Polish Checklist\n\n### Color Scheme\n- Verify colors work on both dark and light terminal backgrounds\n- Test with TERM=xterm-256color and TERM=xterm\n- Consider adding NO_COLOR environment variable support\n\n### Consistency Audit\n- All titles use TitleStyle from styles.go\n- All secondary text uses SubtleStyle\n- All selected items use SelectedStyle\n- All status bars use StatusBarStyle\n- Spacing and margins are consistent across views\n\n### Terminal Compatibility\nTest in:\n- iTerm2 (macOS)\n- Terminal.app (macOS)\n- Windows Terminal\n- Basic xterm\n- Inside tmux session\n- Inside screen session\n\n### Keyboard Shortcuts Audit\nEnsure no conflicts with:\n- Ctrl+C (should work for cancel)\n- Ctrl+Z (should suspend if terminal supports)\n- Arrow keys (should not conflict with scroll)\n- Common tmux prefix (Ctrl+B by default)\n- Common screen prefix (Ctrl+A by default)\n\n## Documentation Updates\n\n### README.md\n\nAdd section about TUI:\n\n```markdown\n## Usage\n\n### Interactive TUI (Default)\n\nSimply run `rafa` with no arguments to launch the interactive interface:\n\n```bash\nrafa\n```\n\nThe TUI allows you to:\n- Create new plans from design documents\n- Run existing plans with real-time progress\n- Monitor task execution with split-view output\n\n### CLI Commands\n\nFor scripting and automation, CLI subcommands remain available:\n\n```bash\nrafa init              # Initialize repository\nrafa plan create FILE  # Create plan from design doc\nrafa plan list         # List all plans\nrafa run PLAN_ID       # Execute a plan\n```\n```\n\n### Any Other Docs\n\nCheck for references to CLI-only usage that should mention TUI option.\n\n## Final Checks\n\n```bash\nmake fmt        # Format all code\nmake check-fmt  # Verify formatting\nmake test       # Run all tests\ngo build ./...  # Verify build\n```",
      "acceptanceCriteria": [
        "All views use styles from styles.go consistently (no inline style definitions)",
        "Color scheme tested on dark terminal background - text is readable",
        "Color scheme tested on light terminal background - text is readable",
        "TUI renders correctly in iTerm2 and Terminal.app",
        "TUI renders correctly inside tmux session (no garbled output)",
        "TUI renders correctly inside screen session",
        "Keyboard shortcuts documented in each view's status bar",
        "No keyboard conflicts with Ctrl+C, Ctrl+Z, or arrow keys",
        "README.md updated with TUI usage section",
        "README.md documents that CLI remains available for scripting",
        "Any CLI-focused docs updated to mention TUI alternative",
        "make fmt produces no changes (code already formatted)",
        "make check-fmt passes",
        "make test passes",
        "go build ./cmd/rafa succeeds with no warnings"
      ],
      "status": "pending",
      "attempts": 0
    }
  ]
}